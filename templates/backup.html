<!DOCTYPE html>
<html lang="pt-br">
  
<style>
    .lista-horizontal {
        display: flex;
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    .lista-horizontal li {
        margin-right: 10px;
        cursor: pointer;
    }

    .selecionado {
        background-color: #aaf;
    }

    .linha-selecionada {
        background-color: #ff0; /* Destaca a linha selecionada */
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Banco de Dados</title>
    <script>
        let registro_calculo = []; // Lista para armazenar os dados selecionados (tabela e potência)

        async function carregarTabelas() {
            const resposta = await fetch('/tabelas');
            const tabelas = await resposta.json();
            let lista = '<h2>Tabelas no Banco</h2><ul class="lista-horizontal">';
            
            tabelas.forEach(tabela => {
                lista += `<li onclick="selecionarTabela('${tabela}')">${tabela}</li>`;
            });
            
            lista += '</ul>';
            document.getElementById('lista-tabelas').innerHTML = lista;
        }

        async function selecionarTabela(tabela) {
            console.log('Tabela selecionada:', tabela);
            const resposta = await fetch(`/dados?tabela=${tabela}`);
            const dados = await resposta.json();
            carregarDados(tabela, dados);
        }

        function carregarDados(tabela, dados) {
            let tabelaHtml = `<h2>Dados da Tabela: ${tabela}</h2>`;
            tabelaHtml += `<table border="1"><tr>
                <th>ID</th><th>Litros</th><th>Volts</th><th>Amper</th>
                <th>Potencia</th><th>Comp.</th><th>Larg.</th><th>Altu.</th>
                <th>Peso</th><th>Marca</th><th>Modelo</th>
            </tr>`;

            dados.forEach(item => {
                tabelaHtml += `<tr onclick="selecionarRegistro(this, '${tabela}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                    <td>${item.id}</td><td>${item.Litros}</td>
                    <td>${item.Volts}</td><td>${item.Amper}</td><td>${item.Potencia}</td>
                    <td>${item.C}</td><td>${item.L}</td><td>${item.A}</td><td>${item.Peso}</td>
                    <td>${item.Marca}</td><td>${item.Modelo}</td>
                </tr>`;
            });

            tabelaHtml += `</table>`;
            document.getElementById('tabela').innerHTML = tabelaHtml;
        }

        function selecionarRegistro(linha, tabela, registro) {
            // Remove destaque de qualquer linha previamente selecionada
            document.querySelectorAll("tr").forEach(tr => tr.classList.remove("linha-selecionada"));
            
            // Adiciona destaque à linha selecionada
            linha.classList.add("linha-selecionada");

            // Exibe os detalhes do registro
            let detalhes = `<h3>Detalhes do Registro</h3><ul>`;
            for (const chave in registro) {
                detalhes += `<li><strong>${chave}:</strong> ${registro[chave]}</li>`;
            }
            detalhes += `</ul>`;
            document.getElementById('detalhes').innerHTML = detalhes;

            // Salva o nome da tabela e o campo 'Potencia' na lista registro_calculo
            let potencia = parseFloat(registro.Potencia); // Garantir que Potencia seja número
            registro_calculo.push([tabela, potencia]); // Adiciona à lista
            console.log("Registro salvo:", [tabela, potencia]); // Exibe no console
            console.log("Lista atualizada:", registro_calculo); // Exibe a lista completa
        }

        function mostrarRegistros() {
            // Exibe a lista de registros armazenados
            let registrosHtml = "<h3>Registros Salvos</h3><ul>";
            registro_calculo.forEach(item => {
                registrosHtml += `<li>Tabela: ${item[0]}, Potência: ${item[1]}</li>`;
            });
            registrosHtml += "</ul>";
            document.getElementById('registros').innerHTML = registrosHtml;
        }
    </script>
</head>
<body onload="carregarTabelas()">
    <h1>Dados do Banco</h1>
    <div id="lista-tabelas"></div>
    <div id="tabela"></div>
    <div id="detalhes"></div>
    <div id="registros"></div> <!-- Div onde os registros salvos serão exibidos -->
    <button onclick="mostrarRegistros()">Mostrar Registros Salvos</button> <!-- Botão para exibir registros -->
</body>
</html>
